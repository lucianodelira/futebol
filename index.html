// Função auxiliar Poisson (mantida igual)
function poissonProb(lambda, k) {
  let p = Math.exp(-lambda);
  let term = 1;
  for (let i = 0; i < k; i++) {
    term *= lambda / (i + 1);
    p += term;
  }
  return p;
}

// Calcula probabilidades (mantida, mas agora retorna também o palpite sorteado)
function calculateProbabilities(homeTeam, awayTeam, leagueId) {
  // ... todo o código anterior de cálculo de lambdaHome e lambdaAway ...
  // (copie exatamente o que você já tinha até o cálculo de pHome, pDraw, pAway, pOver, pUnder)

  // Aqui vamos decidir o palpite final com sorte
  const rand = Math.random() * 100; // número entre 0 e 100

  let resultado;
  let probEscolhida;

  if (rand < pHome) {
    resultado = `Vitória do ${homeTeam}`;
    probEscolhida = pHome;
  } else if (rand < pHome + pDraw) {
    resultado = "Empate";
    probEscolhida = pDraw;
  } else {
    resultado = `Vitória do ${awayTeam}`;
    probEscolhida = pAway;
  }

  return {
    pHome,
    pDraw,
    pAway,
    pOver,
    pUnder,
    palpiteFinal: resultado,
    probDoPalpite: probEscolhida
  };
}

// Dentro do loop de renderização (substitua o trecho que cria o HTML do jogo)
const probs = calculateProbabilities(timeA, timeB, leagueId);

htmlHoje += `
  <div class="jogo-item">
    <div class="jogo-time">${liga} • ${hora} ${status}</div>
    <div class="jogo-times">${timeA} × ${timeB}</div>

    <div class="probabilidades">
      <div class="prob-item vit-mandante">
        <div class="prob-text">Vitória ${timeA}</div>
        <div class="prob-bar"><div class="prob-fill" style="width:${probs.pHome}%"></div></div>
        <div>${probs.pHome}%</div>
      </div>
      <div class="prob-item empate">
        <div class="prob-text">Empate</div>
        <div class="prob-bar"><div class="prob-fill" style="width:${probs.pDraw}%"></div></div>
        <div>${probs.pDraw}%</div>
      </div>
      <div class="prob-item vit-visitante">
        <div class="prob-text">Vitória ${timeB}</div>
        <div class="prob-bar"><div class="prob-fill" style="width:${probs.pAway}%"></div></div>
        <div>${probs.pAway}%</div>
      </div>
    </div>

    <div class="over-under">
      <span class="${probs.pOver > 50 ? 'over' : 'under'}">Over 2.5 gols: ${probs.pOver}%</span> • 
      <span class="${probs.pUnder > 50 ? 'under' : 'over'}">Under 2.5 gols: ${probs.pUnder}%</span>
    </div>

    <!-- Palpite final com sorte -->
    <div style="text-align:center; margin-top:12px; font-size:1.1rem; font-weight:700; color:#00ff9d;">
      Palpite do dia: <strong>${probs.palpiteFinal}</strong> 
      <span style="color:#aaa; font-size:0.85rem;">(${probs.probDoPalpite}% de chance)</span>
    </div>
  </div>
`;
